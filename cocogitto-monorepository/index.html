<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

      <title>Okno&#x27;s blog</title>

      <!-- CSS -->
      <link rel="stylesheet" href="https://oknozor.github.io/blog/print.css" media="print">
      <link rel="stylesheet" href="https://oknozor.github.io/blog/poole.css">
      <link rel="stylesheet" href="https://oknozor.github.io/blog/hyde.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

      

      
      
    </head>

    <body class="theme-base-0d ">
        
            <div class="sidebar">
                <div class="container sidebar-sticky">
                    <div class="sidebar-about">
                        
                            <a href="https:&#x2F;&#x2F;oknozor.github.io&#x2F;blog"><h1>Okno&#x27;s blog</h1></a>
                            
                            <p class="lead">Hello, I am Paul Delafosse AKA Okno, Java software developer by day
Rustacean by night. 
</p>
                            
                        
                    </div>

                    <ul class="sidebar-nav">
                        
                        
                        
                    </ul>
                </div>
            </div>
        

        <div class="content container">
            
<div class="post">
  <h1 class="post-title">Announcing Cocogitto 5.3.0</h1>
  <span class="post-date">2023-01-20</span>
  <p>For those who don't know, <a href="https://docs.cocogitto.io">Cocogitto</a> is a Conventional Commit and
SemVer swiss army knife. You can create Conventional Commits with the CLI, automatically release new version, enforce the
specifications with the GitHub bot and action etc.</p>
<h3 id="changelog">Changelog</h3>
<p>Changelog for the upcomming 5.3.0 version (generated by Cocogitto)</p>
<hr />
<h4 id="bug-fixes">Bug Fixes</h4>
<ul>
<li>ignore merge commits based on parent counts - (<a href="https://github.com/cocogitto/cocogitto/commit/f8b5da64343e60ce5851e2e25b93611bfcf4db05">f8b5da6</a>) - <a href="https://github.com/oknozor">@oknozor</a></li>
<li>signing for chore commits - (<a href="https://github.com/cocogitto/cocogitto/commit/18b9643318cad85bae56a4217b04e3e684650d09">18b9643</a>) - <a href="https://github.com/DaRacci">@DaRacci</a></li>
</ul>
<h4 id="documentation">Documentation</h4>
<ul>
<li>add cargo-smart-release to the list of similar projects - (<a href="https://github.com/cocogitto/cocogitto/commit/3a04e72231626af9717d4e8476e7e5af9c58a8ce">3a04e72</a>) - <a href="https://github.com/oknozor">@oknozor</a></li>
<li>report one binary following <code>coco</code> deprecation - (<a href="https://github.com/cocogitto/cocogitto/commit/3ad6d28d2909f7a51ca384408550776a5e9b50be">3ad6d28</a>) -  <a href="https://github.com/lucatrv">@lucatrv</a></li>
</ul>
<h4 id="features">Features</h4>
<ul>
<li><strong>(cli)</strong> add subcommand for generating manpages - (<a href="https://github.com/cocogitto/cocogitto/commit/fe6bcfe578c00be0ded6463c96c54e7392ee1635">fe6bcfe</a>) - <a href="https://github.com/tranzystorek-io">@tranzystorek-io</a></li>
<li>monorepo support (<a href="https://github.com/cocogitto/cocogitto/pull/240">#240</a>) - (<a href="https://github.com/cocogitto/cocogitto/commit/d8eed3dc7eac644bf56dd1c4bd4dea0bb1d4f746">d8eed3d</a>) - <a href="https://github.com/oknozor">@oknozor</a></li>
<li>NuShell completions - (<a href="https://github.com/cocogitto/cocogitto/commit/3a356ccb0e5838e5fe09fa56a18842fb417eddd7">3a356cc</a>) - <a href="https://github.com/DaRacci">@DaRacci</a></li>
<li>add from_latest_tag to settings - (<a href="https://github.com/cocogitto/cocogitto/commit/a154782639c899fc585b68ea28ce00d2f4bfefb9">a154782</a>) - <a href="https://github.com/stephenc">@stephenc</a></li>
</ul>
<h4 id="miscellaneous-chores">Miscellaneous Chores</h4>
<ul>
<li>bump dependencies and fix rustc-serialize cve - (<a href="https://github.com/cocogitto/cocogitto/commit/fc0e129606911fde53b7256c2fda3b408b3484af">fc0e129</a>) - <a href="https://github.com/oknozor">@oknozor</a></li>
<li>bump clap version to 4.0 - (<a href="https://github.com/cocogitto/cocogitto/commit/dbef47b3fe69c9518dbc5757965c844c37f512fd">dbef47b</a>) - <a href="https://github.com/tranzystorek-io">@tranzystorek-io</a></li>
</ul>
<h4 id="refactoring">Refactoring</h4>
<ul>
<li>simplify project structure for binaries - (<a href="https://github.com/cocogitto/cocogitto/commit/941fb103453e311fe7a51f5cf9573e73e6ff1e80">941fb10</a>) - <a href="https://github.com/tranzystorek-io">@tranzystorek-io</a></li>
</ul>
<h4 id="tests">Tests</h4>
<ul>
<li>hard code init branch to 'master' to avoid conflict with user config - (<a href="https://github.com/cocogitto/cocogitto/commit/d22482e4e2406a4db00d76c25cfcc7ea5e1579c2">d22482e</a>) - <a href="https://github.com/oknozor">@oknozor</a></li>
</ul>
<hr />
<h2 id="thanks">Thanks</h2>
<p>❤️ Kudos to <a href="https://github.com/stephenc">@stephenc</a>, 
<a href="https://github.com/DaRacci">@DaRacci</a>, 
<a href="https://github.com/lucatrv">@lucatrv</a>, 
<a href="https://github.com/tranzystorek-io">@tranzystorek-io</a> who contributed to the upcomming Cocogitto release ! </p>
<h2 id="mono-repository-support">Mono-repository support</h2>
<p>It's been a while since I last worked on it. And it was mainly in maintenance mode. 
But lately I have been working on <a href="https://github.com/oknozor/gill">Gill</a>, an activity pub based git platform. 
It's not ready for production yet, but it is already a big project with a dozen crates in the cargo workspace. </p>
<p>Unfortunately I was not able to use Cocogitto for this project because of its mono-repository nature. 
The least I could do for a project so closely related to git is to correctly manage versioning, so finally 
decided to tackle mono-repo support in Cocogitto. </p>
<p><strong>Global version</strong></p>
<p>Without further ado here is a sample of the first repository changelog generated by Cocogitto:
<img src="https://oknozor.github.io/blog/cocogitto-monorepository/../images/gill-changelog.png" alt="gill-changelog.png" /></p>
<p>As you can see the <a href="https://docs.cocogitto.io/guide/#automatic-versioning">automatic bump</a> performed by Cocogitto
generated a global changelog and created a tag for each updated crate on the workspace. 
There were no previous tag on the repository so a new version was created for each crate. Subsequent bumps will 
generate a new version only for crates modified since the previous release. </p>
<p>The mono-repository bump also generate a global project tag. It's calculated based on the generated package tags 
or on the global commits. </p>
<p><strong>Per package version</strong></p>
<p>The bump also generated a new changelog for each updated crate: </p>
<p><img src="https://oknozor.github.io/blog/cocogitto-monorepository/../images/monorepo-package-changelog.png" alt="monorepo-package-changelog.png" /></p>
<p><strong>How to</strong></p>
<p>Mono-repo support is just a matter of configuration. 
If you have used Cocogitto before, all you need to do is to update your <code>cog.toml</code> to declare your monorepo packages. </p>
<p>Here is a sample of <a href="https://github.com/oknozor/gill/blob/main/cog.toml">Gill's configuration</a></p>
<pre data-lang="toml" style="background-color:#2b303b;color:#c0c5ce;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#bf616a;">pre_bump_hooks </span><span>= [
</span><span>&quot;</span><span style="color:#a3be8c;">SQLX_OFFLINE=true cargo test</span><span>&quot;,
</span><span>&quot;</span><span style="color:#a3be8c;">SQLX_OFFLINE=true cargo clippy</span><span>&quot;,
</span><span>&quot;</span><span style="color:#a3be8c;">cargo fmt --all</span><span>&quot;,
</span><span>&quot;</span><span style="color:#a3be8c;">SQLX_OFFLINE=true cargo build --release</span><span>&quot;,
</span><span>]
</span><span>
</span><span style="color:#bf616a;">post_bump_hooks </span><span>= [
</span><span>&quot;</span><span style="color:#a3be8c;">git push</span><span>&quot;,
</span><span>&quot;</span><span style="color:#a3be8c;">git push origin --tags</span><span>&quot;,
</span><span>]
</span><span>
</span><span style="color:#bf616a;">pre_package_bump_hooks </span><span>= [
</span><span>&quot;</span><span style="color:#a3be8c;">cargo set-version {{version}}</span><span>&quot;
</span><span>]
</span><span>
</span><span>[packages]
</span><span style="color:#bf616a;">gill-app </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-app</span><span>&quot; }
</span><span style="color:#bf616a;">gill-authorize-derive </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-authorize-derive</span><span>&quot;, </span><span style="color:#bf616a;">public_api </span><span>= </span><span style="color:#d08770;">false </span><span>}
</span><span style="color:#bf616a;">gill-db </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-db</span><span>&quot;, </span><span style="color:#bf616a;">public_api </span><span>= </span><span style="color:#d08770;">false </span><span>}
</span><span style="color:#bf616a;">gill-git </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-git</span><span>&quot;, </span><span style="color:#bf616a;">public_api </span><span>= </span><span style="color:#d08770;">false </span><span>}
</span><span style="color:#bf616a;">gill-git-server </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-git-server</span><span>&quot; }
</span><span style="color:#bf616a;">gill-markdown </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-markdown</span><span>&quot;, </span><span style="color:#bf616a;">public_api </span><span>= </span><span style="color:#d08770;">false </span><span>}
</span><span style="color:#bf616a;">gill-settings </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-settings</span><span>&quot; }
</span><span style="color:#bf616a;">gill-syntax </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-syntax</span><span>&quot; }
</span><span style="color:#bf616a;">gill-web-markdown </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/gill-web-markdown</span><span>&quot; }
</span><span style="color:#bf616a;">syntect-plugin </span><span>= { </span><span style="color:#bf616a;">path </span><span>= &quot;</span><span style="color:#a3be8c;">crates/syntect-plugin</span><span>&quot;, </span><span style="color:#bf616a;">public_api </span><span>= </span><span style="color:#d08770;">false </span><span>}
</span></code></pre>
<p><strong>Differences with standard bump</strong></p>
<ul>
<li>Run per package hooks with are define using <code>pre_package_bump_hooks</code>, <code>post_package_bump_hooks</code>. </li>
<li>Package hooks run with the package path as current directory.</li>
<li>They can be overridden per package. For instance if all packages are build with <code>cargo</code> except for a <code>npm</code> frontend. 
you just need to override the hooks for that package. </li>
<li>package declared with <code>public_api = false</code> will be bumped but will not affect the calculated global version. </li>
</ul>

</div>

        </div>

    </body>

</html>
